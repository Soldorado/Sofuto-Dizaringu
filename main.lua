local Slab = require 'Slab'
local nativefs = require 'nativefs'

function love.load(args)
    Slab.SetINIStatePath(nil)
    Grid = love.graphics.newImage("grid.png")
    Grid:setWrap('repeat', 'repeat')
    Grid:setFilter('linear', 'nearest')
    
    ImageList = {}
    CurrentImageIndex = 0
    ImagePos = {X = 0, Y = 0}
    ImageScale = 1
    OpenFile = false
    CurrentFileName = ""
    CurrentlySaving = false
    SaveMessageIsDisplayed = 0
    DoneSaving = false
    ShowOriginal = false
    DitherParameters = {Strength = 1.0, Brightness = 0.0, Contrast = 0.0}
    ParameterChanged = false
    SliderUpdateTimer = 0.0
    ChannelUpdateTimer = 0.0
    ToolbarElementWidth = 150
    PreviewWindowWidth = 0
    ImageData = love.image.newImageData(1, 1)
    ImageDataSize = {Width = 0, Height = 0}

    SplitChannelEnabled = false
    ColorChannels = {Red = 0.30, Green = 0.59, Blue = 0.11}
    ChannelChanged = false

    CurrentScale = 1

	
-- Paletas
PalettesMap = {
    ['Web'] = '000000 000033 000066 000099 0000CC 0000FF 003300 003333 003366 003399 0033CC 0033FF 006600 006633 006666 006699 0066CC 0066FF 009900 009933 009966 009999 0099CC 0099FF 00CC00 00CC33 00CC66 00CC99 00CCCC 00CCFF 00FF00 00FF33 00FF66 00FF99 00FFCC 00FFFF 330000 330033 330066 330099 3300CC 3300FF 333300 333333 333366 333399 3333CC 3333FF 336600 336633 336666 336699 3366CC 3366FF 339900 339933 339966 339999 3399CC 3399FF 33CC00 33CC33 33CC66 33CC99 33CCCC 33CCFF 33FF00 33FF33 33FF66 33FF99 33FFCC 33FFFF 660000 660033 660066 660099 6600CC 6600FF 663300 663333 663366 663399 6633CC 6633FF 666600 666633 666666 666699 6666CC 6666FF 669900 669933 669966 669999 6699CC 6699FF 66CC00 66CC33 66CC66 66CC99 66CCCC 66CCFF 66FF00 66FF33 66FF66 66FF99 66FFCC 66FFFF 990000 990033 990066 990099 9900CC 9900FF 993300 993333 993366 993399 9933CC 9933FF 996600 996633 996666 996699 9966CC 9966FF 999900 999933 999966 999999 9999CC 9999FF 99CC00 99CC33 99CC66 99CC99 99CCCC 99CCFF 99FF00 99FF33 99FF66 99FF99 99FFCC 99FFFF CC0000 CC0033 CC0066 CC0099 CC00CC CC00FF CC3300 CC3333 CC3366 CC3399 CC33CC CC33FF CC6600 CC6633 CC6666 CC6699 CC66CC CC66FF CC9900 CC9933 CC9966 CC9999 CC99CC CC99FF CCCC00 CCCC33 CCCC66 CCCC99 CCCCCC CCCCFF CCFF00 CCFF33 CCFF66 CCFF99 CCFFCC CCFFFF FF0000 FF0033 FF0066 FF0099 FF00CC FF00FF FF3300 FF3333 FF3366 FF3399 FF33CC FF33FF FF6600 FF6633 FF6666 FF6699 FF66CC FF66FF FF9900 FF9933 FF9966 FF9999 FF99CC FF99FF FFCC00 FFCC33 FFCC66 FFCC99 FFCCCC FFCCFF FFFF00 FFFF33 FFFF66 FFFF99 FFFFCC FFFFFF 000000 0A0A0A 151515 1F1F1F 2A2A2A 343434 3F3F3F 4A4A4A 545454 5E5E5E 696969 737373 7E7E7E 898989 939393 9E9E9E A8A8A8 B2B2B2 C8C8C8 D2D2D2 DCDCDC E7E7E7 F1F1F1 FFFFFF 080808 101010 181818 202020 282828 303030 383838 404040 484848 505050 585858 606060 686868 707070 787878 808080',
    ['Commodore 64']   = '000000 FFFFFF 68372B 70A4B2 6F3D86 588D43 352879 B8C76F 6F4F25 433900 955353 A99887 646464 7DCC70 B2A277 757575',
    ['ZX Spectrum']    = '000000 0000D7 0000FF D70000 FF0000 D700D7 FF00FF 00D700 00FF00 D7D700 FFFF00 00D7D7 00FFFF D7D7D7 FFFFFF',
	['Macintosh'] = '000000 000033 000066 000099 0000CC 0000FF 003300 003333 003366 003399 0033CC 0033FF 006600 006633 006666 006699 0066CC 0066FF 009900 009933 009966 009999 0099CC 0099FF 00CC00 00CC33 00CC66 00CC99 00CCCC 00CCFF 00FF00 00FF33 00FF66 00FF99 00FFCC 00FFFF 330000 330033 330066 330099 3300CC 3300FF 333300 333333 333366 333399 3333CC 3333FF 336600 336633 336666 336699 3366CC 3366FF 339900 339933 339966 339999 3399CC 3399FF 33CC00 33CC33 33CC66 33CC99 33CCCC 33CCFF 33FF00 33FF33 33FF66 33FF99 33FFCC 33FFFF 660000 660033 660066 660099 6600CC 6600FF 663300 663333 663366 663399 6633CC 6633FF 666600 666633 666666 666699 6666CC 6666FF 669900 669933 669966 669999 6699CC 6699FF 66CC00 66CC33 66CC66 66CC99 66CCCC 66CCFF 66FF00 66FF33 66FF66 66FF99 66FFCC 66FFFF 990000 990033 990066 990099 9900CC 9900FF 993300 993333 993366 993399 9933CC 9933FF 996600 996633 996666 996699 9966CC 9966FF 999900 999933 999966 999999 9999CC 9999FF 99CC00 99CC33 99CC66 99CC99 99CCCC 99CCFF 99FF00 99FF33 99FF66 99FF99 99FFCC 99FFFF CC0000 CC0033 CC0066 CC0099 CC00CC CC00FF CC3300 CC3333 CC3366 CC3399 CC33CC CC33FF CC6600 CC6633 CC6666 CC6699 CC66CC CC66FF CC9900 CC9933 CC9966 CC9999 CC99CC CC99FF CCCC00 CCCC33 CCCC66 CCCC99 CCCCCC CCCCFF CCFF00 CCFF33 CCFF66 CCFF99 CCFFCC CCFFFF FF0000 FF0033 FF0066 FF0099 FF00CC FF00FF FF3300 FF3333 FF3366 FF3399 FF33CC FF33FF FF6600 FF6633 FF6666 FF6699 FF66CC FF66FF FF9900 FF9933 FF9966 FF9999 FF99CC FF99FF FFCC00 FFCC33 FFCC66 FFCC99 FFCCCC FFCCFF FFFF00 FFFF33 FFFF66 FFFF99 FFFFCC FFFFFF 000000 111111 222222 333333 444444 555555 666666 777777 888888 999999 AAAAAA BBBBBB CCCCCC DDDDDD EEEEEE FFFFFF 000000 111111 222222 333333 444444 555555 666666 777777 888888 999999 AAAAAA BBBBBB CCCCCC DDDDDD EEEEEE FFFFFF',
    ['Atari ST 512 colores']   = '000000 000022 000044 000066 000088 0000AA 0000CC 0000EE 002200 002222 002244 002266 002288 0022AA 0022CC 0022EE 004400 004422 004444 004466 004488 0044AA 0044CC 0044EE 006600 006622 006644 006666 006688 0066AA 0066CC 0066EE 008800 008822 008844 008866 008888 0088AA 0088CC 0088EE 00AA00 00AA22 00AA44 00AA66 00AA88 00AAAA 00AACC 00AAEE 00CC00 00CC22 00CC44 00CC66 00CC88 00CCAA 00CCCC 00CCEE 00EE00 00EE22 00EE44 00EE66 00EE88 00EEAA 00EECC 00EEEE 220000 220022 220044 220066 220088 2200AA 2200CC 2200EE 222200 222222 222244 222266 222288 2222AA 2222CC 2222EE 224400 224422 224444 224466 224488 2244AA 2244CC 2244EE 226600 226622 226644 226666 226688 2266AA 2266CC 2266EE 228800 228822 228844 228866 228888 2288AA 2288CC 2288EE 22AA00 22AA22 22AA44 22AA66 22AA88 22AAAA 22AACC 22AAEE 22CC00 22CC22 22CC44 22CC66 22CC88 22CCAA 22CCCC 22CCEE 22EE00 22EE22 22EE44 22EE66 22EE88 22EEAA 22EECC 22EEEE 440000 440022 440044 440066 440088 4400AA 4400CC 4400EE 442200 442222 442244 442266 442288 4422AA 4422CC 4422EE 444400 444422 444444 444466 444488 4444AA 4444CC 4444EE 446600 446622 446644 446666 446688 4466AA 4466CC 4466EE 448800 448822 448844 448866 448888 4488AA 4488CC 4488EE 44AA00 44AA22 44AA44 44AA66 44AA88 44AAAA 44AACC 44AAEE 44CC00 44CC22 44CC44 44CC66 44CC88 44CCAA 44CCCC 44CCEE 44EE00 44EE22 44EE44 44EE66 44EE88 44EEAA 44EECC 44EEEE 660000 660022 660044 660066 660088 6600AA 6600CC 6600EE 662200 662222 662244 662266 662288 6622AA 6622CC 6622EE 664400 664422 664444 664466 664488 6644AA 6644CC 6644EE 666600 666622 666644 666666 666688 6666AA 6666CC 6666EE 668800 668822 668844 668866 668888 6688AA 6688CC 6688EE 66AA00 66AA22 66AA44 66AA66 66AA88 66AAAA 66AACC 66AAEE 66CC00 66CC22 66CC44 66CC66 66CC88 66CCAA 66CCCC 66CCEE 66EE00 66EE22 66EE44 66EE66 66EE88 66EEAA 66EECC 66EEEE 880000 880022 880044 880066 880088 8800AA 8800CC 8800EE 882200 882222 882244 882266 882288 8822AA 8822CC 8822EE 884400 884422 884444 884466 884488 8844AA 8844CC 8844EE 886600 886622 886644 886666 886688 8866AA 8866CC 8866EE 888800 888822 888844 888866 888888 8888AA 8888CC 8888EE 88AA00 88AA22 88AA44 88AA66 88AA88 88AAAA 88AACC 88AAEE 88CC00 88CC22 88CC44 88CC66 88CC88 88CCAA 88CCCC 88CCEE 88EE00 88EE22 88EE44 88EE66 88EE88 88EEAA 88EECC 88EEEE AA0000 AA0022 AA0044 AA0066 AA0088 AA00AA AA00CC AA00EE AA2200 AA2222 AA2244 AA2266 AA2288 AA22AA AA22CC AA22EE AA4400 AA4422 AA4444 AA4466 AA4488 AA44AA AA44CC AA44EE AA6600 AA6622 AA6644 AA6666 AA6688 AA66AA AA66CC AA66EE AA8800 AA8822 AA8844 AA8866 AA8888 AA88AA AA88CC AA88EE AAAA00 AAAA22 AAAA44 AAAA66 AAAA88 AAAAAA AAAACC AAAAEE AACC00 AACC22 AACC44 AACC66 AACC88 AACCAA AACCCC AACCFF AAEE00 AAEE22 AAEE44 AAEE66 AAEE88 AAEEAA AAEECC AAEEEE CC0000 CC0022 CC0044 CC0066 CC0088 CC00AA CC00CC CC00EE CC2200 CC2222 CC2244 CC2266 CC2288 CC22AA CC22CC CC22EE CC4400 CC4422 CC4444 CC4466 CC4488 CC44AA CC44CC CC44EE CC6600 CC6622 CC6644 CC6666 CC6688 CC66AA CC66CC CC66EE CC8800 CC8822 CC8844 CC8866 CC8888 CC88AA CC88CC CC88EE CCAA00 CCAA22 CCAA44 CCAA66 CCAA88 CCAAAA CCAACC CCAAEE CCCC00 CCCC22 CCCC44 CCCC66 CCCC88 CCCCAA CCCCFF CCCCEE CCEE00 CCEE22 CCEE44 CCEE66 CCEE88 CCEEAA CCEECC CCEEEE EE0000 EE0022 EE0044 EE0066 EE0088 EE00AA EE00CC EE00EE EE2200 EE2222 EE2244 EE2266 EE2288 EE22AA EE22CC EE22EE EE4400 EE4422 EE4444 EE4466 EE4488 EE44AA EE44CC EE44EE EE6600 EE6622 EE6644 EE6666 EE6688 EE66AA EE66CC EE66EE EE8800 EE8822 EE8844 EE8866 EE8888 EE88AA EE88CC EE88EE EEAA00 EEAA22 EEAA44 EEAA66 EEAA88 EEAAAA EEAAEE EAECC EEE00 EEE22 EEE44 EEE66 EEE88 EEEAA EEECC EEEEE',
    ['Pc-88 512 colores']    = '000000 000055 0000AA 0000FF 005500 005555 0055AA 0055FF 00AA00 00AA55 00AAAA 00AAFF 00FF00 00FF55 00FFAA 00FFFF 550000 550055 5500AA 5500FF 555500 555555 5555AA 5555FF 55AA00 55AA55 55AAAA 55AAFF 55FF00 55FF55 55FFAA 55FFFF AA0000 AA0055 AA00AA AA00FF AA5500 AA5555 AA55AA AA55FF AAAA00 AAAA55 AAAAAA AAAAFF AAFF00 AAFF55 AAFF98 AAFFC2 AAFFE6 AAFFFF FF0000 FF0055 FF00AA FF00FF FF5500 FF5555 FF55AA FF55FF FFAA00 FFAA55 FFAAAA FFAAFF FFFF00 FFFF55 FFFFAA FFFFFF 000000 00002A 000055 000080 0000AA 0000D5 0000FF 002A00 002A2A 002A55 002A80 002AAA 002AD5 002AFF 005500 00552A 005555 005580 0055AA 0055D5 0055FF 008000 00802A 008055 008080 0080AA 0080D5 0080FF 00AA00 00AA2A 00AA55 00AA80 00AAAA 00AAD5 00AAFF 00D500 00D52A 00D555 00D580 00D5AA 00D5D5 00D5FF 00FF00 00FF2A 00FF55 00FF80 00FFAA 00FFD5 00FFFF 2A0000 2A002A 2A0055 2A0080 2A00AA 2A00D5 2A00FF 2A2A00 2A2A2A 2A2A55 2A2A80 2A2AAA 2A2AD5 2A2AFF 2A5500 2A552A 2A5555 2A5580 2A55AA 2A55D5 2A55FF 2A8000 2A802A 2A8055 2A8080 2A80AA 2A80D5 2A80FF 2AAA00 2AAA2A 2AAA55 2AAA80 2AAAAA 2AAAD5 2AAAFF 2AD500 2AD52A 2AD555 2AD580 2AD5AA 2AD5D5 2AD5FF 2AFF00 2AFF2A 2AFF55 2AFF80 2AFFAA 2AFFD5 2AFFFF 550000 55002A 550055 550080 5500AA 5500D5 5500FF 552A00 552A2A 552A55 552A80 552AAA 552AD5 552AFF 555500 55552A 555555 555580 5555AA 5555D5 5555FF 558000 55802A 558055 558080 5580AA 5580D5 5580FF 55AA00 55AA2A 55AA55 55AA80 55AAAA 55AAD5 55AAFF 55D500 55D52A 55D555 55D580 55D5AA 55D5D5 55D5FF 55FF00 55FF2A 55FF55 55FF80 55FFAA 55FFD5 55FFFF 800000 80002A 800055 800080 8000AA 8000D5 8000FF 802A00 802A2A 802A55 802A80 802AAA 802AD5 802AFF 805500 80552A 805555 805580 8055AA 8055D5 8055FF 808000 80802A 808055 808080 8080AA 8080D5 8080FF 80AA00 80AA2A 80AA55 80AA80 80AAAA 80AAD5 80AAFF 80D500 80D52A 80D555 80D580 80D5AA 80D5D5 80D5FF 80FF00 80FF2A 80FF55 80FF80 80FFAA 80FFD5 80FFFF AA0000 AA002A AA0055 AA0080 AA00AA AA00D5 AA00FF AA2A00 AA2A2A AA2A55 AA2A80 AA2AAA AA2AD5 AA2AFF AA5500 AA552A AA5555 AA5580 AA55AA AA55D5 AA55FF AA8000 AA802A AA8055 AA8080 AA80AA AA80D5 AA80FF AAAA00 AAAA2A AAAA55 AAAA80 AAAAAA AAAAD5 AAAAFF AAD500 AAD52A AAD555 AAD580 AAD5AA AAD5D5 AAD5FF AAFF00 AAFF2A AAFF55 AAFF80 AAFF98 AAFFC2 AAFFE6 AAFFFF D50000 D5002A D50055 D50080 D500AA D500D5 D500FF D52A00 D52A2A D52A55 D52A80 D52AAA D52AD5 D52AFF D55500 D5552A D55555 D55580 D555AA D555D5 D555FF D58000 D5802A D58055 D58080 D580AA D580D5 D580FF D5AA00 D5AA2A D5AA55 D5AA80 D5AAAA D5AAD5 D5AAFF D5D500 D5D52A D5D555 D5D580 D5D5AA D5D5D5 D5D5FF D5FF00 D5FF2A D5FF55 D5FF80 D5FFAA D5FFD5 D5FFFF FF0000 FF002A FF0055 FF0080 FF00AA FF00D5 FF00FF FF2A00 FF2A2A FF2A55 FF2A80 FF2AAA FF2AD5 FF2AFF FF5500 FF552A FF5555 FF5580 FF55AA FF55D5 FF55FF FF8000 FF802A FF8055 FF8080 FF80AA FF80D5 FF80FF FFAA00 FFAA2A FFAA55 FFAA80 FFAAAA FFAAD5 FFAAFF FFD500 FFD52A FFD555 FFD580 FFD5AA FFD5D5 FFD5FF FFFF00 FFFF2A FFFF55 FFFF80 FFFFAA FFFFD5 FFFFFF',
	['Pc-98 256 colores'] = '000000 000080 008000 008080 800000 800080 808000 808080 C0C0C0 0000FF 00FF00 00FFFF FF0000 FF00FF FFFF00 FFFFFF 808080 C0C0C0 E0E0E0 FFFFFF 000000 00005F 000087 0000AF 0000D7 0000FF 005F00 005F5F 005F87 005FAF 005FD7 005FFF 008700 00875F 008787 0087AF 0087D7 0087FF 00AF00 00AF5F 00AF87 00AFAF 00AFD7 00AFFF 00D700 00D75F 00D787 00D7AF 00D7D7 00D7FF 00FF00 00FF5F 00FF87 00FFAF 00FFD7 00FFFF 5F0000 5F005F 5F0087 5F00AF 5F00D7 5F00FF 5F5F00 5F5F5F 5F5F87 5F5FAF 5F5FD7 5F5FFF 5F8700 5F875F 5F8787 5F87AF 5F87D7 5F87FF 5FAF00 5FAF5F 5FAF87 5FAFAF 5FAFD7 5FAFFF 5FD700 5FD75F 5FD787 5FD7AF 5FD7D7 5FD7FF 5FFF00 5FFF5F 5FFF87 5FFFAF 5FFFD7 5FFFFF 870000 87005F 870087 8700AF 8700D7 8700FF 875F00 875F5F 875F87 875FAF 875FD7 875FFF 878700 87875F 878787 8787AF 8787D7 8787FF 87AF00 87AF5F 87AF87 87AFAF 87AFD7 87AFFF 87D700 87D75F 87D787 87D7AF 87D7D7 87D7FF 87FF00 87FF5F 87FF87 87FFAF 87FFD7 87FFFF AF0000 AF005F AF0087 AF00AF AF00D7 AF00FF AF5F00 AF5F5F AF5F87 AF5FAF AF5FD7 AF5FFF AF8700 AF875F AF8787 AF87AF AF87D7 AF87FF AFAF00 AFAF5F AFAF87 AFAFAF AFAFD7 AFAFFF AFD700 AFD75F AFD787 AFD7AF AFD7D7 AFD7FF AFFF00 AFFF5F AFFF87 AFFFAF AFFFD7 AFFFFF D70000 D7005F D70087 D700AF D700D7 D700FF D75F00 D75F5F D75F87 D75FAF D75FD7 D75FFF D78700 D7875F D78787 D787AF D787D7 D787FF D7AF00 D7AF5F D7AF87 D7AFAF D7AFD7 D7AFFF D7D700 D7D75F D7D787 D7D7AF D7D7D7 D7D7FF D7FF00 D7FF5F D7FF87 D7FFAF D7FFD7 D7FFFF FF0000 FF005F FF0087 FF00AF FF00D7 FF00FF FF5F00 FF5F5F FF5F87 FF5FAF FF5FD7 FF5FFF FF8700 FF875F FF8787 FF87AF FF87D7 FF87FF FFAF00 FFAF5F FFAF87 FFAFAF FFAFD7 FFAFFF FFD700 FFD75F FFD787 FFD7AF FFD7D7 FFD7FF FFFF00 FFFF5F FFFF87 FFFFAF FFFFD7 FFFFFF',
	['Sharp MZ-800'] = '000000 000080 008000 008080 800000 800080 808000 808080 0000FF 00FF00 00FFFF FF0000 FF00FF FFFF00 FFFFFF',
    ['Sharp X68000 256 colores']   = '000000 000033 000066 000099 0000CC 0000FF 003300 003333 003366 003399 0033CC 0033FF 006600 006633 006666 006699 0066CC 0066FF 009900 009933 009966 009999 0099CC 0099FF 00CC00 00CC33 00CC66 00CC99 00CCCC 00CCFF 00FF00 00FF33 00FF66 00FF99 00FFCC 00FFFF 330000 330033 330066 330099 3300CC 3300FF 333300 333333 333366 333399 3333CC 3333FF 336600 336633 336666 336699 3366CC 3366FF 339900 339933 339966 339999 3399CC 3399FF 33CC00 33CC33 33CC66 33CC99 33CCCC 33CCFF 33FF00 33FF33 33FF66 33FF99 33FFCC 33FFFF 660000 660033 660066 660099 6600CC 6600FF 663300 663333 663366 663399 6633CC 6633FF 666600 666633 666666 666699 6666CC 6666FF 669900 669933 669966 669999 6699CC 6699FF 66CC00 66CC33 66CC66 66CC99 66CCCC 66CCFF 66FF00 66FF33 66FF66 66FF99 66FFCC 66FFFF 990000 990033 990066 990099 9900CC 9900FF 993300 993333 993366 993399 9933CC 9933FF 996600 996633 996666 996699 9966CC 9966FF 999900 999933 999966 999999 9999CC 9999FF 99CC00 99CC33 99CC66 99CC99 99CCCC 99CCFF 99FF00 99FF33 99FF66 99FF99 99FFCC 99FFFF CC0000 CC0033 CC0066 CC0099 CC00CC CC00FF CC3300 CC3333 CC3366 CC3399 CC33CC CC33FF CC6600 CC6633 CC6666 CC6699 CC66CC CC66FF CC9900 CC9933 CC9966 CC9999 CC99CC CC99FF CCCC00 CCCC33 CCCC66 CCCC99 CCCCCC CCCCFF CCFF00 CCFF33 CCFF66 CCFF99 CCFFCC CCFFFF FF0000 FF0033 FF0066 FF0099 FF00CC FF00FF FF3300 FF3333 FF3366 FF3399 FF33CC FF33FF FF6600 FF6633 FF6666 FF6699 FF66CC FF66FF FF9900 FF9933 FF9966 FF9999 FF99CC FF99FF FFCC00 FFCC33 FFCC66 FFCC99 FFCCCC FFCCFF FFFF00 FFFF33 FFFF66 FFFF99 FFFFCC FFFFFF 101010 202020 303030 404040 505050 606060 707070 808080 909090 A0A0A0 B0B0B0 C0C0C0 D0D0D0 E0E0E0 F0F0F0 FFFFFF',
	['Sharp X68000 512 colores'] = '000000 000024 000049 000073 000098 0000C2 0000E6 0000FF 002400 002424 002449 002473 002498 0024C2 0024E6 0024FF 004900 004924 004949 004973 004998 0049C2 0049E6 0049FF 007300 007324 007349 007373 007398 0073C2 0073E6 0073FF 009800 009824 009849 009873 009898 0098C2 0098E6 0098FF 00C200 00C224 00C249 00C273 00C298 00C2C2 00C2E6 00C2FF 00E600 00E624 00E649 00E673 00E698 00E6C2 00E6E6 00E6FF 00FF00 00FF24 00FF49 00FF73 00FF98 00FFC2 00FFE6 00FFFF 240000 240024 240049 240073 240098 2400C2 2400E6 2400FF 242400 242424 242449 242473 242498 2424C2 2424E6 2424FF 244900 244924 244949 244973 244998 2449C2 2449E6 2449FF 247300 247324 247349 247373 247398 2473C2 2473E6 2473FF 249800 249824 249849 249873 249898 2498C2 2498E6 2498FF 24C200 24C224 24C249 24C273 24C298 24C2C2 24C2E6 24C2FF 24E600 24E624 24E649 24E673 24E698 24E6C2 24E6E6 24E6FF 24FF00 24FF24 24FF49 24FF73 24FF98 24FFC2 24FFE6 24FFFF 490000 490024 490049 490073 490098 4900C2 4900E6 4900FF 492400 492424 492449 492473 492498 4924C2 4924E6 4924FF 494900 494924 494949 494973 494998 4949C2 4949E6 4949FF 497300 497324 497349 497373 497398 4973C2 4973E6 4973FF 499800 499824 499849 499873 499898 4998C2 4998E6 4998FF 49C200 49C224 49C249 49C273 49C298 49C2C2 49C2E6 49C2FF 49E600 49E624 49E649 49E673 49E698 49E6C2 49E6E6 49E6FF 49FF00 49FF24 49FF49 49FF73 49FF98 49FFC2 49FFE6 49FFFF 730000 730024 730049 730073 730098 7300C2 7300E6 7300FF 732400 732424 732449 732473 732498 7324C2 7324E6 7324FF 734900 734924 734949 734973 734998 7349C2 7349E6 7349FF 737300 737324 737349 737373 737398 7373C2 7373E6 7373FF 739800 739824 739849 739873 739898 7398C2 7398E6 7398FF 73C200 73C224 73C249 73C273 73C298 73C2C2 73C2E6 73C2FF 73E600 73E624 73E649 73E673 73E698 73E6C2 73E6E6 73E6FF 73FF00 73FF24 73FF49 73FF73 73FF98 73FFC2 73FFE6 73FFFF 980000 980024 980049 980073 980098 9800C2 9800E6 9800FF 982400 982424 982449 982473 982498 9824C2 9824E6 9824FF 984900 984924 984949 984973 984998 9849C2 9849E6 9849FF 987300 987324 987349 987373 987398 9873C2 9873E6 9873FF 989800 989824 989849 989873 989898 9898C2 9898E6 9898FF 98C200 98C224 98C249 98C273 98C298 98C2C2 98C2E6 98C2FF 98E600 98E624 98E649 98E673 98E698 98E6C2 98E6E6 98E6FF 98FF00 98FF24 98FF49 98FF73 98FF98 98FFC2 98FFE6 98FFFF C20000 C20024 C20049 C20073 C20098 C200C2 C200E6 C200FF C22400 C22424 C22449 C22473 C22498 C224C2 C224E6 C224FF C24900 C24924 C24949 C24973 C24998 C249C2 C249E6 C249FF C27300 C27324 C27349 C27373 C27398 C273C2 C273E6 C273FF C29800 C29824 C29849 C29873 C29898 C298C2 C298E6 C298FF C2C200 C2C224 C2C249 C2C273 C2C298 C2C2C2 C2C2E6 C2C2FF C2E600 C2E624 C2E649 C2E673 C2E698 C2E6C2 C2E6E6 C2E6FF C2FF00 C2FF24 C2FF49 C2FF73 C2FF98 C2FFC2 C2FFE6 C2FFFF E60000 E60024 E60049 E60073 E60098 E600C2 E600E6 E600FF E62400 E62424 E62449 E62473 E62498 E624C2 E624E6 E624FF E64900 E64924 E64949 E64973 E64998 E649C2 E649E6 E649FF E67300 E67324 E67349 E67373 E67398 E673C2 E673E6 E673FF E69800 E69824 E69849 E69873 E69898 E698C2 E698E6 E698FF E6C200 E6C224 E6C249 E6C273 E6C298 E6C2C2 E6C2E6 E6C2FF E6E600 E6E624 E6E649 E6E673 E6E698 E6E6C2 E6E6E6 E6E6FF E6FF00 E6FF24 E6FF49 E6FF73 E6FF98 E6FFC2 E6FFE6 E6FFFF FF0000 FF0024 FF0049 FF0073 FF0098 FF00C2 FF00E6 FF00FF FF2400 FF2424 FF2449 FF2473 FF2498 FF24C2 FF24E6 FF24FF FF4900 FF4924 FF4949 FF4973 FF4998 FF49C2 FF49E6 FF49FF FF7300 FF7324 FF7349 FF7373 FF7398 FF73C2 FF73E6 FF73FF FF9800 FF9824 FF9849 FF9873 FF9898 FF98C2 FF98E6 FF98FF FFC200 FFC224 FFC249 FFC273 FFC298 FFC2C2 FFC2E6 FFC2FF FFE600 FFE624 FFE649 FFE673 FFE698 FFE6C2 FFE6E6 FFE6FF FFFF00 FFFF24 FFFF49 FFFF73 FFFF98 FFFFC2 FFFFE6 FFFFFF',
    ['Sharp PC-1210']   = '000000 E0E8C0',
    ['Sharp PC-1350']    = '000000 C0C0C0',
	['Sharp PC-1401'] = '000000 C0C9C9',
    ['Sharp PC-E500S']   = '000000 A4C699',
    ['Sharp MZ-80B']    = '000000 00FF00',
	['Sharp MZ-80B lavanda'] = '000000 2F1B4E',
    ['Sharp MZ-6500']   = '000000 000033 000066 000099 0000CC 0000FF 003300 003333 003366 003399 0033CC 0033FF 006600 006633 006666 006699 0066CC 0066FF 009900 009933 009966 009999 0099CC 0099FF 00CC00 00CC33 00CC66 00CC99 00CCCC 00CCFF 00FF00 00FF33 00FF66 00FF99 00FFCC 00FFFF 330000 330033 330066 330099 3300CC 3300FF 333300 333333 333366 333399 3333CC 3333FF 336600 336633 336666 336699 3366CC 3366FF 339900 339933 339966 339999 3399CC 3399FF 33CC00 33CC33 33CC66 33CC99 33CCCC 33CCFF 33FF00 33FF33 33FF66 33FF99 33FFCC 33FFFF 660000 660033 660066 660099 6600CC 6600FF 663300 663333 663366 663399 6633CC 6633FF 666600 666633 666666 666699 6666CC 6666FF 669900 669933 669966 669999 6699CC 6699FF 66CC00 66CC33 66CC66 66CC99 66CCCC 66CCFF 66FF00 66FF33 66FF66 66FF99 66FFCC 66FFFF 990000 990033 990066 990099 9900CC 9900FF 993300 993333 993366 993399 9933CC 9933FF 996600 996633 996666 996699 9966CC 9966FF 999900 999933 999966 999999 9999CC 9999FF 99CC00 99CC33 99CC66 99CC99 99CCCC 99CCFF 99FF00 99FF33 99FF66 99FF99 99FFCC 99FFFF CC0000 CC0033 CC0066 CC0099 CC00CC CC00FF CC3300 CC3333 CC3366 CC3399 CC33CC CC33FF CC6600 CC6633 CC6666 CC6699 CC66CC CC66FF CC9900 CC9933 CC9966 CC9999 CC99CC CC99FF CCCC00 CCCC33 CCCC66 CCCC99 CCCCCC CCCCFF CCFF00 CCFF33 CCFF66 CCFF99 CCFFCC CCFFFF FF0000 FF0033 FF0066 FF0099 FF00CC FF00FF FF3300 FF3333 FF3366 FF3399 FF33CC FF33FF FF6600 FF6633 FF6666 FF6699 FF66CC FF66FF FF9900 FF9933 FF9966 FF9999 FF99CC FF99FF FFCC00 FFCC33 FFCC66 FFCC99 FFCCCC FFCCFF FFFF00 FFFF33 FFFF66 FFFF99 FFFFCC FFFFFF',
    ['Sharp X1']    = '000000 0000FF 00FF00 00FFFF FF0000 FF00FF FFFF00 FFFFFF',
	['Sharp PC-7000'] = '000000 99CC99',
    ['NEC PC-9801LS']   = '000000 FF8000',
    ['NEC PC-6001'] = '008000 A4C699',
    ['Hewlett Packard Model 85']    = '000000 ADD8E6',
    ['Amiga 1000 OCS']   = '000000 0000FF 00FF00 00FFFF FF0000 FF00FF FFFF00 FFFFFF 008800 000088 880000 888800 880088 008888 888888 444444',
    ['Amiga 1000 HAM']    = '000000 000088 0000FF 008800 008888 0088FF 00FF00 00FF88 00FFFF 880000 880088 8800FF 888800 888888 8888FF 88FF00 88FF88 88FFFF FF0000 FF0088 FF00FF FF8800 FF8888 FF88FF FFFF00 FFFF88 FFFFFF 112233 445566 778899 AABBCC DDEEFF',
	['Zenith Z-171 PC'] = '000000 0093FF',
    ['AT&T UNIX PC']   = '000000 00C96F',
    ['Linus Write-Top'] = '000000 00FF00',
    ['GRiDPad']   = '000000 4D584C A6C09C',
    ['NCR-3125'] = '000000 101010 212121 313131 414141 525252 626262 727272 838383 939393 A3A3A3 B4B4B4 C4C4C4 D5D5D5 E5E5E5 F5F5F5',
    ['IBM ThinkPad 710T']   = '000000 111111 222222 333333 444444 555555 666666 777777 888888 999999 AAAAAA BBBBBB CCCCCC DDDDDD EEEEEE FFFFFF',
    ['Apple Newton H1000'] = '000000 111122 222233 333344 444455 555566 666677 777788 888899 9999AA AAAABB BBBBBCC CCCCDD DDDDEE EEEFFF FFFFFF',
    ['Zeos Pocket PC']   = '000000 111100 222211 333322 444433 555544 666655 777766 888877 999988 AAA99 AAAA99 BBBBAA CCCCCB DDDDCC EEEEED FFFFFE',
    ['Atari 2600 NTSC'] = '000000 000000 000000 000000 000000 000000 000000 000000 606060 606020 602020 602060 206020 206060 202060 202020 9C9C9C 9C9C40 9C4040 9C409C 409C40 409C9C 40409C 404040 C0C0C0 C0C050 C05050 C050C0 50C050 50C0C0 5050C0 505050 DCDCDC DCDC58 DC5858 DC58DC 58DC58 58DCDC 5858DC 585858 F0F0F0 F0F060 F06060 F060F0 60F060 60F0F0 6060F0 606060 ECECEC ECEC60 EC6060 EC60EC 60EC60 60ECEC 6060EC 606060 C0C0C0 C0C050 C05050 C050C0 50C050 50C0C0 5050C0 505050 E0E0E0 E0E070 E07070 E070E0 70E070 70E0E0 7070E0 707070 F5F5F5 F5F580 F58080 F580F5 80F580 80F5F5 8080F5 808080 F8F8F8 F8F890 F89090 F890F8 90F890 90F8F8 9090F8 909090 FCFCFC FCFCB0 FCB0B0 FCB0FC B0FCB0 B0FCFC B0B0FC B0B0B0 FFFCFC FFFCE0 FCE0E0 FCE0FC E0FCE0 E0FCFC E0E0FC E0E0E0 FFF0F0 FFF0E0 F0E0E0 F0E0F0 E0F0E0 E0F0F0 E0E0F0 E0E0E0 FFFFF0 FFFFE0 FFE0E0 FFE0FF E0FFE0 E0FFFE E0E0FF E0E0E0 FFFFFF FFFFFF FFFFFF FFFFFF FFFFFF FFFFFF FFFFFF FFFFFF',
    ['Atari 2600 Pal']   = '000000 000000 000000 000000 000000 000000 000000 000000 000000 000000 000000 000000 000000 000000 000000 000000 686868 682800 680000 680028 280028 280068 002868 002828 006800 286800 686800 682800 686868 686868 686868 686868 8c8c8c 8c4c10 8c1010 8c104c 4c104c 4c108c 104c8c 104c4c 108c10 4c8c10 8c8c10 8c4c10 8c8c8c 8c8c8c 8c8c8c 8c8c8c b0b0b0 b07020 b02020 b02070 702070 7020b0 2070b0 207070 20b020 70b020 b0b020 b07020 b0b0b0 b0b0b0 b0b0b0 b0b0b0 cccccccc c88030 c83030 c83080 803080 8030c8 3080c8 308080 30c830 80c830 c8c830 c88030 cccccccc cccccccc cccccccc cccccccc e0e0e0 d4903c d43c3c d43c90 903c90 903cd4 3c90d4 3c9090 3cd43c 90d43c d4d43c d4903c e0e0e0 e0e0e0 e0e0e0 e0e0e0 e8e8e8 e8a444 e84444 e844a4 a444a4 a444e8 44a4e8 44a4a4 44e844 a4e844 e8e844 e8a444 e8e8e8 e8e8e8 e8e8e8 e8e8e8 f0f0f0 f0b84c f04c4c f04cb8 b84cb8 b84cf0 4cf0b8 4cf04c 4cf04c b8f04c f0f04c f0b84c f0f0f0 f0f0f0 f0f0f0 f0f0f0 fcfcfc fcd064 fcd064 fcd0d0 d0d0d0 d0d0fc d0d0d0 d0d0d0 d0d0d0 d0d0d0 d0d0d0 d0d0d0 fcfcfc fcfcfc fcfcfc fcfcfc ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff',
    ['Game Boy Original']    = '0f380f 306230 8bac0f 9bbc0f',
    ['Game Boy Pocket Light'] = '000000 555555 AAAAAA FFFFFF',
    ['Game Boy Light']   = '6a716c 434b47 aebc98 dce0c0',
	['Game Boy Light Backlit']   = '003828 008c58 00b484 00d89c',
    ['Nes'] = '848484 0000BC 442144 840000 9C0000 84001A 5C007E 100072 001460 003C00 004800 00421E 003846 000000 000000 000000 C4C4C4 0078F8 6840E8 A82010 B40000 A8005A 7400AE 2810C8 0038A8 006400 007200 006A2A 006060 000000 000000 000000 F8F8F8 3CBCFF 9878F8 C06010 E44000 F05840 C044B0 4C30D0 0868D8 088000 088800 087850 087084 080808 080808 080808 F8F8F8 A4E4FF C0B0F8 D8A040 F89000 F8845C F87898 A860E4 5098F8 48B800 58C000 58B868 58B0B0 505050 505050 505050',
	['Super Nintendo 16 colores']   = '000000 555555 AAAAAA FFFFFF 0000AA 00AA00 00AAAA AA0000 AA00AA AAAA00 5555AA 55AA55 55AAAA AA5555 AA55AA AAAA55',
    ['Super Nintendo 125 colores']   = '000000 000040 000080 0000C0 0000FF 004000 004040 004080 0040C0 0040FF 008000 008040 008080 0080C0 0080FF 00C000 00C040 00C080 00C0C0 00C0FF 00FF00 00FF40 00FF80 00FFC0 00FFFF 400000 400040 400080 4000C0 4000FF 404000 404040 404080 4040C0 4040FF 408000 408040 408080 4080C0 4080FF 40C000 40C040 40C080 40C0C0 40C0FF 40FF00 40FF40 40FF80 40FFC0 40FFFF 800000 800040 800080 8000C0 8000FF 804000 804040 804080 8040C0 8040FF 808000 808040 808080 8080C0 8080FF 80C000 80C040 80C080 80C0C0 80C0FF 80FF00 80FF40 80FF80 80FFC0 80FFFF C00000 C00040 C00080 C000C0 C000FF C04000 C04040 C04080 C040C0 C040FF C08000 C08040 C08080 C080C0 C080FF C0C000 C0C040 C0C080 C0C0C0 C0C0FF C0FF00 C0FF40 C0FF80 C0FFC0 C0FFFF FF0000 FF0040 FF0080 FF00C0 FF00FF FF4000 FF4040 FF4080 FF40C0 FF40FF FF8000 FF8040 FF8080 FF80C0 FF80FF FFC000 FFC040 FFC080 FFC0C0 FFC0FF FFFF00 FFFF40 FFFF80 FFFFC0 FFFFFF',
    ['Super Nintendo 256 colores']   = '000000 000080 0000C0 0000FF 008000 008080 0080C0 0080FF 00C000 00C080 00C0C0 00C0FF 00FF00 00FF80 00FFC0 00FFFF 800000 800080 8000C0 8000FF 808000 808080 8080C0 8080FF 80C000 80C080 80C0C0 80C0FF 80FF00 80FF80 80FFC0 80FFFF C00000 C00080 C000C0 C000FF C08000 C08080 C080C0 C080FF C0C000 C0C080 C0C0C0 C0C0FF C0FF00 C0FF80 C0FFC0 C0FFFF FF0000 FF0080 FF00C0 FF00FF FF8000 FF8080 FF80C0 FF80FF FFC000 FFC080 FFC0C0 FFC0FF FFFF00 FFFF80 FFFFC0 FFFFFF 101010 202020 303030 404040 505050 606060 707070 808080 909090 A0A0A0 B0B0B0 C0C0C0 D0D0D0 E0E0E0 F0F0F0 FFFFFF 100000 100080 1000C0 1000FF 108000 108080 1080C0 1080FF 10C000 10C080 10C0C0 10C0FF 10FF00 10FF80 10FFC0 10FFFF 200000 200080 2000C0 2000FF 208000 208080 2080C0 2080FF 20C000 20C080 20C0C0 20C0FF 20FF00 20FF80 20FFC0 20FFFF 300000 300080 3000C0 3000FF 308000 308080 3080C0 3080FF 30C000 30C080 30C0C0 30C0FF 30FF00 30FF80 30FFC0 30FFFF 400000 400080 4000C0 4000FF 408000 408080 4080C0 4080FF 40C000 40C080 40C0C0 40C0FF 40FF00 40FF80 40FFC0 40FFFF 500000 500080 5000C0 5000FF 508000 508080 5080C0 5080FF 50C000 50C080 50C0C0 50C0FF 50FF00 50FF80 50FFC0 50FFFF 600000 600080 6000C0 6000FF 608000 608080 6080C0 6080FF 60C000 60C080 60C0C0 60C0FF 60FF00 60FF80 60FFC0 60FFFF 700000 700080 7000C0 7000FF 708000 708080 7080C0 7080FF 70C000 70C080 70C0C0 70C0FF 70FF00 70FF80 70FFC0 70FFFF',
	['Game Boy Color Brown'] = '4D2C1C 946E4A B4907A D2B9A0',
    ['Game Boy Color Pale yellow'] = '1D0F4A 4B388D 9C77C6 C1A5E9',
    ['Game Boy Color Blue'] = '003273 0060A9 368CB8 98B2C4',
	['Game Boy Color Green'] = '296338 52945D 7AB482 B6D0B4',
    ['Game Boy Color Red'] = '6B0727 C63E48 E1A3A3 F5C6C6',
	['Game Boy Color Orange'] = '551B13 8A4E21 B77636 D9AA71',
	['Game Boy Color Dark blue'] = '272B4D 464E8C 7882BB B9C1D9',
	['Game Boy Color Dark green'] = '384A28 668846 95B468 C4D89A',
	['Game Boy Color Dark brown'] = '23241D 484A3B 707469 9B9FA2',
	['Game Boy Color Yellow'] = '21210A 4E4E1C 828236 C9C967',
	['Game Boy Color Gray'] = '323232 777777 AFAFAF E3E3E3',
	['Game Boy Color Reverse'] = '000000 3C7300 B8F894 FFFFFF',
	['Sega Master System'] = '000000 550000 AA0000 FF0000 005500 555500 AA5500 FF5500 00AA00 55AA00 AAAA00 FFAA00 00FF00 55FF00 AAFF00 FFFF00 000055 550055 AA0055 FF0055 005555 555555 AA5555 FF5555 00AA55 55AA55 AAAA55 FFAA55 00FF55 55FF55 AAFF55 FFFF55 0000AA 5500AA AA00AA FF00AA 0055AA 5555AA AA55AA FF55AA 00AAAA 55AAAA AAAAAA FFAAAA 00FFAA 55FFAA AAFFAC FFFFAC 0000FF 5500FF AA00FF FF00FF 0055FF 5555FF AA55FF FF55FF 00AAFF 55AAFF AAAAF FFFAAF 00FFFF 55FFFF AAFFFF FFFFFF',
    ['Sega Mega drive'] = '000000 000024 000049 00006D 000092 0000B6 0000DB 0000FF 002400 002424 002449 00246D 002492 0024B6 0024DB 0024FF 004900 004924 004949 00496D 004992 0049B6 0049DB 0049FF 006D00 006D24 006D49 006D6D 006D92 006DB6 006DDB 006DFF 009200 009224 009249 00926D 009292 0092B6 0092DB 0092FF 00B600 00B624 00B649 00B66D 00B692 00B6B6 00B6DB 00B6FF 00DB00 00DB24 00DB49 00DB6D 00DB92 00DBB6 00DBDB 00DBFF 00FF00 00FF24 00FF49 00FF6D 00FF92 00FFB6 00FFDB 00FFFF 240000 240024 240049 24006D 240092 2400B6 2400DB 2400FF 242400 242424 242449 24246D 242492 2424B6 2424DB 2424FF 244900 244924 244949 24496D 244992 2449B6 2449DB 2449FF 246D00 246D24 246D49 246D6D 246D92 246DB6 246DDB 246DFF 249200 249224 249249 24926D 249292 2492B6 2492DB 2492FF 24B600 24B624 24B649 24B66D 24B692 24B6B6 24B6DB 24B6FF 24DB00 24DB24 24DB49 24DB6D 24DB92 24DBB6 24DBDB 24DBFF 24FF00 24FF24 24FF49 24FF6D 24FF92 24FFB6 24FFDB 24FFFF 490000 490024 490049 49006D 490092 4900B6 4900DB 4900FF 492400 492424 492449 49246D 492492 4924B6 4924DB 4924FF 494900 494924 494949 49496D 494992 4949B6 4949DB 4949FF 496D00 496D24 496D49 496D6D 496D92 496DB6 496DDB 496DFF 499200 499224 499249 49926D 499292 4992B6 4992DB 4992FF 49B600 49B624 49B649 49B66D 49B692 49B6B6 49B6DB 49B6FF 49DB00 49DB24 49DB49 49DB6D 49DB92 49DBB6 49DBDB 49DBFF 49FF00 49FF24 49FF49 49FF6D 49FF92 49FFB6 49FFDB 49FFFF 6D0000 6D0024 6D0049 6D006D 6D0092 6D00B6 6D00DB 6D00FF 6D2400 6D2424 6D2449 6D246D 6D2492 6D24B6 6D24DB 6D24FF 6D4900 6D4924 6D4949 6D496D 6D4992 6D49B6 6D49DB 6D49FF 6D6D00 6D6D24 6D6D49 6D6D6D 6D6D92 6D6DB6 6D6DDB 6D6DFF 6D9200 6D9224 6D9249 6D926D 6D9292 6D92B6 6D92DB 6D92FF 6DB600 6DB624 6DB649 6DB66D 6DB692 6DB6B6 6DB6DB 6DB6FF 6DDB00 6DDB24 6DDB49 6DDB6D 6DDB92 6DDBB6 6DDBDB 6DDBFF 6DFF00 6DFF24 6DFF49 6DFF6D 6DFF92 6DFFB6 6DFFDB 6DFFFF 920000 920024 920049 92006D 920092 9200B6 9200DB 9200FF 922400 922424 922449 92246D 922492 9224B6 9224DB 9224FF 924900 924924 924949 92496D 924992 9249B6 9249DB 9249FF 926D00 926D24 926D49 926D6D 926D92 926DB6 926DDB 926DFF 929200 929224 929249 92926D 929292 9292B6 9292DB 9292FF 92B600 92B624 92B649 92B66D 92B692 92B6B6 92B6DB 92B6FF 92DB00 92DB24 92DB49 92DB6D 92DB92 92DBB6 92DBDB 92DBFF 92FF00 92FF24 92FF49 92FF6D 92FF92 92FFB6 92FFDB 92FFFF B60000 B60024 B60049 B6006D B60092 B600B6 B600DB B600FF B62400 B62424 B62449 B6246D B62492 B624B6 B624DB B624FF B64900 B64924 B64949 B6496D B64992 B649B6 B649DB B649FF B66D00 B66D24 B66D49 B66D6D B66D92 B66DB6 B66DDB B66DFF B69200 B69224 B69249 B6926D B69292 B692B6 B692DB B692FF B6B600 B6B624 B6B649 B6B66D B6B692 B6B6B6 B6B6DB B6B6FF B6DB00 B6DB24 B6DB49 B6DB6D B6DB92 B6DBB6 B6DBDB B6DBFF B6FF00 B6FF24 B6FF49 B6FF6D B6FF92 B6FFB6 B6FFDB B6FFFF DB0000 DB0024 DB0049 DB006D DB0092 DB00B6 DB00DB DB00FF DB2400 DB2424 DB2449 DB246D DB2492 DB24B6 DB24DB DB24FF DB4900 DB4924 DB4949 DB496D DB4992 DB49B6 DB49DB DB49FF DB6D00 DB6D24 DB6D49 DB6D6D DB6D92 DB6DB6 DB6DDB DB6DFF DB9200 DB9224 DB9249 DB926D DB9292 DB92B6 DB92DB DB92FF DBB600 DBB624 DBB649 DBB66D DBB692 DBB6B6 DBB6DB DBB6FF DBDB00 DBDB24 DBDB49 DBDB6D DBDB92 DBDBB6 DBDBDB DBDBFF DBFF00 DBFF24 DBFF49 DBFF6D DBFF92 DBFFB6 DBFFDB DBFFFF FF0000 FF0024 FF0049 FF006D FF0092 FF00B6 FF00DB FF00FF FF2400 FF2424 FF2449 FF246D FF2492 FF24B6 FF24DB FF24FF FF4900 FF4924 FF4949 FF496D FF4992 FF49B6 FF49DB FF49FF FF6D00 FF6D24 FF6D49 FF6D6D FF6D92 FF6DB6 FF6DDB FF6DFF FF9200 FF9224 FF9249 FF926D FF9292 FF92B6 FF92DB FF92FF FFB600 FFB624 FFB649 FFB66D FFB692 FFB6B6 FFB6DB FFB6FF FFDB00 FFDB24 FFDB49 FFDB6D FFDB92 FFDBB6 FFDBDB FFDBFF FFFF00 FFFF24 FFFF49 FFFF6D FFFF92 FFFFB6 FFFFDB FFFFFF',
    ['Fairchild Channel F'] = '000000 686868 4040ff 60ff40 802020 ff8080 ff6060 ffc0c0',
	['Virtual boy'] = 'ff0000 b7000d 870000 630000 300000',
	['Motorola International 3200'] = '000000 4D584C',
	['Nokia 2110'] = '000000 C6D8C6',
	['Nokia 6510'] = '000000 00BFFF',
	['NEC E616 tape'] = '000000 010102 020204 030306 040408 05050A 06060C 07070E 080810 090912 0A0A14 0B0B16 0C0C18 0D0D1A 0E0E1C 0F0F1E 101020 111122 121224 131326 141428 15152A 16162C 17172E 181830 191932 1A1A34 1B1B36 1C1C38 1D1D3A 1E1E3C 1F1F3E 202040 212142 222244 232346 242448 25254A 26264C 27274E 282850 292952 2A2A54 2B2B56 2C2C58 2D2D5A 2E2E5C 2F2F5E 303060 313162 323264 333366 343468 35356A 36366C 37376E 383870 393972 3A3A74 3B3B76 3C3C78 3D3D7A 3E3E7C 3F3F7E 404080 414182 424284 434386 444488 45458A 46468C 47478E 484890 494992 4A4A94 4B4B96 4C4C98 4D4D9A 4E4E9C 4F4F9E 5050A0 5151A2 5252A4 5353A6 5454A8 5555AA 5656AC 5757AE 5858B0 5959B2 5A5AB4 5B5BB6 5C5CB8 5D5DBA 5E5EBC 5F5FBE 6060C0 6161C2 6262C4 6363C6 6464C8 6565CA 6666CC 6767CE 6868D0 6969D2 6A6AD4 6B6BD6 6C6CD8 6D6DDD 6E6DDF 6F6FE1 7070E3 7171E5 7272E7 7373E9 7474EB 7575ED 7676EF 7777F1 7878F3 7979F5 7A7AF7 7B7BF9 7C7CFB 7D7DFD 7E7EFF 7F7FFF 8080FF 8181FF 8282FF 8383FF 8484FF 8585FF 8686FF 8787FF 8888FF 8989FF 8A8AFF 8B8BFF 8C8CFF 8D8DFF 8E8EFF 8F8FFF 9090FF 9191FF 9292FF 9393FF 9494FF 9595FF 9696FF 9797FF 9898FF 9999FF 9A9AFF 9B9BFF 9C9CFF 9D9DFF 9E9EFF 9F9FFF A0A0FF A1A1FF A2A2FF A3A3FF A4A4FF A5A5FF A6A6FF A7A7FF A8A8FF A9A9FF AAAAFF ABABFF ACACFF ADADFF AEAEAE AFAFAF B0B0B0 B1B1B1 B2B2B2 B3B3B3 B4B4B4 B5B5B5 B6B6B6 B7B7B7 B8B8B8 B9B9B9 BABABA BBBBBB BCBCBC BDBDBD BEBEBE BFBFBF C0C0C0 C1C1C1 C2C2C2 C3C3C3 C4C4C4 C5C5C5 C6C6C6 C7C7C7 C8C8C8 C9C9C9 CACACA CBCBCB CCCCCC CDCDCD CECECE CFCFCF D0D0D0 D1D1D1 D2D2D2 D3D3D3 D4D4D4 D5D5D5 D6D6D6 D7D7D7 D8D8D8 D9D9D9 DADADA DBDBDB DCDCDC DDDDDD DEDEDE DFDFDF E0E0E0 E1E1E1 E2E2E2 E3E3E3 E4E4E4 E5E5E5 E6E6E6 E7E7E7 E8E8E8 E9E9E9 EAEAEA EBEBEB ECECEC EDEDED EEEEEE EFEFEF F0F0F0 F1F1F1 F2F2F2 F3F3F3 F4F4F4 F5F5F5 F6F6F6 F7F7F7 F8F8F8 F9F9F9 FAFAFA FBFBFB FCFCFC FDFDFD FEFEFE FFFFFF',
	['NEC 9A'] = '000000 728C47',
    -- Listado de paletas
}
	
    PaletteNames = {'Web', 'Commodore 64', 'ZX Spectrum', 'Macintosh', 'Atari ST 512 colores', 'Pc-88 512 colores', 'Pc-98 256 colores', 'Sharp MZ-800', 'Sharp X68000 256 colores', 'Sharp X68000 512 colores', 'Sharp PC-1210', 'Sharp PC-1350', 'Sharp PC-1401', 'Sharp PC-E500S', 'Sharp MZ-80B', 'Sharp MZ-80B lavanda', 'Sharp MZ-6500', 'Sharp X1', 'Sharp PC-7000', 'NEC PC-9801LS', 'NEC PC-6001', 'Hewlett Packard Model 85', 'Amiga 1000 OCS', 'Amiga 1000 HAM', 'Zenith Z-171 PC', 'AT&T UNIX PC', 'Linus Write-Top', 'GRiDPad', 'NCR-3125', 'IBM ThinkPad 710T', 'Apple Newton H1000', 'Zeos Pocket PC', 'Atari 2600 NTSC', 'Atari 2600 Pal', 'Game Boy Original', 'Game Boy Pocket Light', 'Game Boy Light', 'Game Boy Light Backlit', 'Nes', 'Super Nintendo 16 colores', 'Super Nintendo 125 colores', 'Super Nintendo 256 colores', 'Game Boy Color Brown', 'Game Boy Color Pale yellow', 'Game Boy Color Blue', 'Game Boy Color Green', 'Game Boy Color Red', 'Game Boy Color Orange', 'Game Boy Color Dark blue', 'Game Boy Color Dark green', 'Game Boy Color Dark brown', 'Game Boy Color Yellow', 'Game Boy Color Gray', 'Game Boy Color Reverse', 'Sega Master System', 'Sega Mega drive', 'Fairchild Channel F', 'Virtual boy', 'Motorola International 3200', 'Nokia 2110', 'Nokia 6510', 'NEC E616 tape', 'NEC 9A', 'Aseprite'}

    SelectedPalette = 'Web'

    SelectedDitherType = 'Bayer Matrix'
    DitherTypes = {'Bayer Matrix', 'Ordered Dithering Matrix', 'Error Diffusion Matrix', 'Random'}

    SelectedBayerType = '8x8'
    SelectedBayerType1 = '8'
    SelectedBayerType2 = '8'
    BayerTypes = {'2x2', '3x3', '3x5', '5x3', '4x4', '8x8', '16x16', '32x32', '64x64'}
    CustomBayerTypes = {'1','2', '4', '8', '16', '32', '64', '128', '256'}
    UseCustomBayerType = false

    SelectedOrderedType = 'ClusteredDot4x4'
    OrderedTypes = {
        'Vertical5x3',
        'Horizontal3x5',
        'ClusteredDotVerticalLine',
        'ClusteredDotHorizontalLine',
        'ClusteredDot4x4',
        'ClusteredDotSpiral5x5',
        'ClusteredDot6x6',
        'ClusteredDot6x6-2',
        'ClusteredDot6x6-3',
        'ClusteredDotDiagonal6x6',
        'ClusteredDot8x8',
        'ClusteredDotDiagonal8x8',
        'ClusteredDotDiagonal8x8-2',
        'ClusteredDotDiagonal8x8-3',
        'ClusteredDotDiagonal16x16'
    }

    SelectedErrorType = 'FloydSteinberg'
    ErrorTypes = {
        'Simple2D',
        'FloydSteinberg',
        'FalseFloydSteinberg',
        'JarvisJudiceNinke',
        'Atkinson',
        'Stucki',
        'Burkes',
        'Sierra',
        'TwoRowSierra',
        'SierraLite',
        'StevenPigeon'
    }
    Serpentine = false

    RandomMin = -0.5
    RandomMax = 0.5

    love.window.setMode(1280, 720, {resizable = true})
    --love.window.maximize()
    ResizeWindows()
    --LoadImage()

    Slab.SetScrollSpeed(30)
    Slab.SetINIStatePath(nil)
    Slab.Initialize(args)
end

--__________________________START UPDATE_____________________________
-- The update function draws the entire UI
function love.update(dt)
    Slab.Update(dt)

    if ChannelChanged and ChannelUpdateTimer ~= 0.0 then
        if love.timer.getTime() - ChannelUpdateTimer >= 0.1 then
            ChannelChanged = false
            ChannelUpdateTimer = 0.0
            SplitChannel()
        end
    end

    if ParameterChanged and SliderUpdateTimer ~= 0.0 then
        if love.timer.getTime() - SliderUpdateTimer >= 0.1 then
            ParameterChanged = false
            SliderUpdateTimer = 0.0
            DitherImage()
        end
    end

    -- This if statement handles the file browser, which allows opening a single image or multiple images using shift or control
    if OpenFile then
        local Result = Slab.FileDialog({Type = 'openfile', AllowMultiSelect = true})
    
        if Result.Button == "OK" then
            if #(Result.Files) ~= 0 then
                ImageList = {}
                for i = 1, #(Result.Files) do
                    local fileName = Result.Files[i]
                    if Result.Files[i] and (string.lower(string.sub(fileName, #fileName - 3, #fileName)) == '.png' or string.lower(string.sub(fileName, #fileName - 3, #fileName)) == '.jpg' or string.lower(string.sub(fileName, #fileName - 4, #fileName)) == '.jpeg') then
                        print('Loaded ' .. fileName)
                        ImageList[#ImageList + 1] = fileName
                    end
                end
                if ImageList[1] then
                    OpenImageFile(ImageList[1])
                    CurrentImageIndex = 1
                end
            end
        end

        if Result.Button ~= "" then
            OpenFile = false
        end
    end

    if CurrentlySaving and SaveMessageIsDisplayed > 5 and not DoneSaving then
        SaveAllImages()
        DoneSaving = true
    end
    
    if CurrentlySaving then
        local saveMessage = "Guardando..."
        if DoneSaving == true then
            saveMessage = "Guardado... ¡Listo!"
        end
        local Result = Slab.MessageBox("Guardando", saveMessage)
    
        SaveMessageIsDisplayed = SaveMessageIsDisplayed + 1
        
        if Result ~= "" then
            CurrentlySaving = false
            DoneSaving = false
            SaveMessageIsDisplayed = 0
        end
    end

    Slab.BeginWindow('PreviewWindow', WindowOptions)

    local mousePosX, _ = Slab.GetMousePosition()
    PreviewWindowWidth, _ = Slab.GetWindowSize()
    if mousePosX < PreviewWindowWidth and Slab.IsMouseDragging(1) then 
        local deltaX, deltaY = Slab.GetMouseDelta()
        ImagePos.X = math.floor(ImagePos.X + deltaX)
        ImagePos.Y = math.floor(ImagePos.Y + deltaY)
    end
    if not PreviewImage then 
        Slab.BeginLayout('OpenFileLayout', {AlignX = 'center', AlignY = 'center'})
        if Slab.Button('Abrir imagen(s)...') then
            OpenFile = true
        end
        Slab.Text('o')
        Slab.Text('Arrastra la imagen o carpeta a la ventana')
        Slab.EndLayout()
    end
    Slab.SetCursorPos(ImagePos.X, ImagePos.Y)
    if PreviewImage then Slab.Image('PreviewImage', {Image = PreviewImage, Scale = ImageScale}) end
    Slab.EndWindow()

    Slab.BeginWindow('Toolbar', ToolbarOptions)
    Slab.BeginLayout('ToolbarLayout1', {AlignX = 'center'})

    Slab.Separator({H = 20})
    if Slab.Button('Abrir imagen(s)...', {W = ToolbarElementWidth, H = 50}) then
        OpenFile = true
    end

    Slab.Text("Imagen " .. CurrentImageIndex .. " de " .. #ImageList)
    if ImageList[CurrentImageIndex] then
        Slab.Text(CurrentFileName)
    end

    if PreviewImage then
        Slab.Text("Tamaño: (" .. math.floor(ImageDataSize.Width * CurrentScale) .. "x" ..  math.floor(ImageDataSize.Height * CurrentScale) .. ")")
        if Slab.Input('CurrentScale', {W = ToolbarElementWidth, Text = CurrentScale, NumbersOnly = true, MinNumber = 0.01, MaxNumber = 1.0, Precision = 2, UseSlider = true}) then 
            CurrentScale = Slab.GetInputNumber()
            ParameterChanged = true
        end
    end

    Slab.Separator({H = 20})

    if Slab.CheckBox(SplitChannelEnabled, "Mezclador. Solo 2 colores") then
        SplitChannelEnabled = not SplitChannelEnabled
        if SplitChannelEnabled and PreviewImage then
            SplitChannel()
        elseif PreviewImage then
            DitherImage()
        end
    end

    if SplitChannelEnabled then
        if Slab.Input('RedChannel', {W = ToolbarElementWidth, Text = ColorChannels.Red, NumbersOnly = true, MinNumber = 0.0, MaxNumber = 1.0, Precision = 2, UseSlider = true, BgColor = {1.0, 0.0, 0.0}}) then 
            ColorChannels.Red = Slab.GetInputNumber()
            ChannelChanged = true
        end
        if Slab.Input('GreenChannel', {W = ToolbarElementWidth, Text = ColorChannels.Green, NumbersOnly = true, MinNumber = 0.0, MaxNumber = 1.0, Precision = 2, UseSlider = true, BgColor = {0.0, 1.0, 0.0}}) then 
            ColorChannels.Green = Slab.GetInputNumber()
            ChannelChanged = true
        end
        if Slab.Input('BlueChannel', {W = ToolbarElementWidth, Text = ColorChannels.Blue, NumbersOnly = true, MinNumber = 0.0, MaxNumber = 1.0, Precision = 2, UseSlider = true, BgColor = {0.0, 0.0, 1.0}}) then 
            ColorChannels.Blue = Slab.GetInputNumber()
            ChannelChanged = true
        end
        if Slab.Button('Resetear') then
            ColorChannels.Red = 0.30
            ColorChannels.Green = 0.59
            ColorChannels.Blue = 0.11
            SplitChannel()
        end
    end

    Slab.Separator({H = 20})

    if Slab.Button('Fuerza') then
        DitherParameters.Strength = 1.0
        DitherImage()
    end
    if Slab.Input('Strength', {W = ToolbarElementWidth, Text = DitherParameters.Strength, NumbersOnly = true, MinNumber = -1.0, MaxNumber = 1.0, Precision = 2, UseSlider = true}) then 
        DitherParameters.Strength = Slab.GetInputNumber()
        ParameterChanged = true
    end

    if Slab.Button('Brillo') then
        DitherParameters.Brightness = 0.0
        DitherImage()
    end
    if Slab.Input('Brightness', {W = ToolbarElementWidth, Text = DitherParameters.Brightness, NumbersOnly = true, MinNumber = -1.0, MaxNumber = 1.0, Precision = 2, UseSlider = true}) then 
        DitherParameters.Brightness = Slab.GetInputNumber()
        ParameterChanged = true
    end

    if Slab.Button('Contraste') then
        DitherParameters.Contrast = 0.0
        DitherImage()
    end
    if Slab.Input('Contrast', {W = ToolbarElementWidth, Text = DitherParameters.Contrast, NumbersOnly = true, MinNumber = -1.0, MaxNumber = 1.0, Precision = 2, UseSlider = true}) then 
        DitherParameters.Contrast = Slab.GetInputNumber()
        ParameterChanged = true
    end
	
	    Slab.Separator({H = 20})
    Slab.Text('Selección de Paleta')

    -- Usa el ComboBox de Slab para seleccionar la paleta
    if Slab.BeginComboBox('PaletteComboBox', {Selected = SelectedPalette, W = ToolbarElementWidth}) then
        for I, V in ipairs(PaletteNames) do
            if Slab.TextSelectable(V) then
                SelectedPalette = V -- Actualiza la variable de estado
                DitherImage() -- Asumo que llamas a una función DitherImage() cuando cambias opciones
            end
        end
        Slab.EndComboBox()
    end

    Slab.Separator({H = 20})

    Slab.Text('Tipo de tramado')
    if Slab.BeginComboBox('DitherTypeComboBox', {Selected = SelectedDitherType, W = ToolbarElementWidth}) then
        for I, V in ipairs(DitherTypes) do
            if Slab.TextSelectable(V) then
                SelectedDitherType = V
                DitherImage()
            end
        end
        Slab.EndComboBox()
    end

    Slab.Separator({H = 20})

    if SelectedDitherType == 'Bayer Matrix' then
        Slab.Text('Dimensiones de Bayer')

        if Slab.CheckBox(UseCustomBayerType, "personalizar tramado Bayer") then
            UseCustomBayerType = not UseCustomBayerType
            DitherImage()
        end

        Slab.Separator({H = 20})
        
        if UseCustomBayerType then
            Slab.BeginLayout('BayerComboLayout', {AlignX = 'center', Columns = 5})
            Slab.SetLayoutColumn(1)
            Slab.Text(' ')
            Slab.SetLayoutColumn(2)
            if Slab.BeginComboBox('BayerType1ComboBox', {Selected = SelectedBayerType1}) then
                for I, V in ipairs(CustomBayerTypes) do
                    if Slab.TextSelectable(V) then
                        SelectedBayerType1 = V
                        DitherImage()
                    end
                end
                Slab.EndComboBox()
            end
            Slab.SetLayoutColumn(3)
            Slab.Text('x')
            Slab.SetLayoutColumn(4)
            if Slab.BeginComboBox('BayerType2ComboBox', {Selected = SelectedBayerType2}) then
                for I, V in ipairs(CustomBayerTypes) do
                    if Slab.TextSelectable(V) then
                        SelectedBayerType2 = V
                        DitherImage()
                    end
                end
                Slab.EndComboBox()
            end
            Slab.EndLayout()
        else
            if Slab.BeginComboBox('BayerTypeComboBox', {Selected = SelectedBayerType}) then
                for I, V in ipairs(BayerTypes) do
                    if Slab.TextSelectable(V) then
                        SelectedBayerType = V
                        DitherImage()
                    end
                end
                Slab.EndComboBox()
            end
        end
    end

    if SelectedDitherType == 'Random' then
        if Slab.Button('Rango de ruido aleatorio') then
            RandomMin = -0.5
            RandomMax = 0.5
            DitherImage()
        end
        if Slab.Input('Random Min', {W = ToolbarElementWidth, Text = RandomMin, NumbersOnly = true, MinNumber = -2.0, MaxNumber = 2.0, Precision = 2, UseSlider = true}) then 
            RandomMin = Slab.GetInputNumber()
            if RandomMin > RandomMax then RandomMin = RandomMax end
            ParameterChanged = true
        end

        if Slab.Input('Random Max', {W = ToolbarElementWidth, Text = RandomMax, NumbersOnly = true, MinNumber = -2.0, MaxNumber = 2.0, Precision = 2, UseSlider = true}) then 
            RandomMax = Slab.GetInputNumber()
            if RandomMax < RandomMin then RandomMax = RandomMin end
            ParameterChanged = true
        end
    end

    if SelectedDitherType == 'Ordered Dithering Matrix' then
        Slab.Text('Matriz de tramado ordenado')
        if Slab.BeginComboBox('OrderedTypeComboBox', {Selected = SelectedOrderedType, W = ToolbarElementWidth}) then
            for I, V in ipairs(OrderedTypes) do
                if Slab.TextSelectable(V) then
                    SelectedOrderedType = V
                    DitherImage()
                end
            end
            Slab.EndComboBox()
        end
    end

    if SelectedDitherType == 'Error Diffusion Matrix' then
        Slab.Text('Matriz de difusión de errores')

        if Slab.CheckBox(Serpentine, "Usar serpentina") then
            Serpentine = not Serpentine
            DitherImage()
        end

        Slab.Separator({H = 20})

        if Slab.BeginComboBox('ErrorTypeComboBox', {Selected = SelectedErrorType, W = ToolbarElementWidth}) then
            for I, V in ipairs(ErrorTypes) do
                if Slab.TextSelectable(V) then
                    SelectedErrorType = V
                    DitherImage()
                end
            end
            Slab.EndComboBox()
        end
    end

    Slab.EndLayout()

    Slab.Separator({H = 20})

    Slab.BeginLayout('ToolbarLayout3', {AlignX = 'center', AlignY = 'bottom'})

    if Slab.CheckBox(ShowOriginal, "Mostrar original") then
        ShowOriginal = not ShowOriginal
        if PreviewImage then ReloadImage() end
    end

    Slab.Separator({H = 20})

    if Slab.Button('Guardar todo', {W = ToolbarElementWidth, H = 50}) and PreviewImage then
        CurrentlySaving = true
    end
    Slab.Separator({H = 20})
    Slab.EndLayout()
    Slab.EndWindow()
end

--__________________________END UPDATE_____________________________

-- Draw the current image to the window
function love.draw()
    local quad = love.graphics.newQuad(0, 0, love.graphics.getWidth(), love.graphics.getHeight(), 64 * ImageScale, 64 * ImageScale)
    love.graphics.draw(Grid, quad)
    Slab.Draw()
end

-- If the window is resized, recalculate toolbars
function love.resize()
    ResizeWindows()
end

-- Switches current image when left and right arrow keys are pressed
function love.keypressed(key, scancode, isrepeat)
    if isrepeat then return end
    if #ImageList == 0 or #ImageList == 1 then return end
    if key == "right" then
        CurrentImageIndex = CurrentImageIndex + 1
        if CurrentImageIndex > #ImageList then CurrentImageIndex = 1 end
        OpenImageFile(ImageList[CurrentImageIndex])
    end
    if key == "left" then
        CurrentImageIndex = CurrentImageIndex - 1
        if CurrentImageIndex < 1 then CurrentImageIndex = #ImageList end
        OpenImageFile(ImageList[CurrentImageIndex])
    end
 end

 -- Handle zooming image when mouse wheel scrolls
function love.wheelmoved(x, y)
    if OpenFile then return end
    local mousePosX, _ = Slab.GetMousePosition()
    if mousePosX > PreviewWindowWidth then return end
    if not PreviewImage then return end

    local prevImageScale = ImageScale
    ImageScale = math.floor(ImageScale + x + y)
    if ImageScale < 1 then ImageScale = 1 end
    if prevImageScale == ImageScale then return end
    ImagePos = {X = math.floor((WindowOptions.W / 2.0) - ((PreviewImage:getWidth() * ImageScale) / 2.0)), Y = math.floor((WindowOptions.H / 2.0) - ((PreviewImage:getHeight() * ImageScale) / 2.0))}
end

-- This is used to prevent bug with didder not using the current slider values when releasing the mouse
function love.mousereleased(x, y, button)
    if button == 1 and PreviewImage and ParameterChanged and SliderUpdateTimer == 0.0 then
        SliderUpdateTimer = love.timer.getTime()
    end
    if button == 1 and PreviewImage and ChannelChanged and ChannelUpdateTimer == 0.0 then
        ChannelUpdateTimer = love.timer.getTime()
    end
 end

-- Calls the copy command from the operating system, this is platform dependant
function CopyFile(source, destination)
    local copyString = [[copy "]] .. source .. [[" "]] .. destination
    copyString = string.gsub(copyString, [[/]], [[\]]) -- Converts paths to backslash for Windows. I think Mac and Linux use forward slash.
    print("\n" .. copyString .. "\n")
    io.popen(copyString):close()
end

-- Called if user drags file into window, loads a single image
function love.filedropped(file)
    local fileName = file:getFilename()
    if file and (string.lower(string.sub(fileName, #fileName - 3, #fileName)) == '.png' or string.lower(string.sub(fileName, #fileName - 3, #fileName)) == '.jpg' or string.lower(string.sub(fileName, #fileName - 4, #fileName)) == '.jpeg') then
        CurrentImageIndex = 1
        ImageList = {}
        ImageList[1] = fileName
        print('Loaded ' .. fileName)
        OpenImageFile(fileName)
        print(fileName)
    else
        print('Unsupported file type. Only .png, .jpg, and .jpeg are supported.')
    end
end

-- Called if user drags directory into window, this uses a library called nativefs. Loads all supported images from the directory
function love.directorydropped(path)
    local files = nativefs.getDirectoryItemsInfo(path)
    if #files ~= 0 then
        ImageList = {}
        for i = 1 , #files do
            if files[i].type == "file" then
                local imagePath = path .. '\\' .. files[i].name
                if imagePath and (string.lower(string.sub(imagePath, #imagePath - 3, #imagePath)) == '.png' or string.lower(string.sub(imagePath, #imagePath - 3, #imagePath)) == '.jpg' or string.lower(string.sub(imagePath, #imagePath - 4, #imagePath)) == '.jpeg') then
                    print('Loaded ' .. imagePath)
                    ImageList[#ImageList + 1] = imagePath
                end
            end
        end
        if ImageList[1] then
            OpenImageFile(ImageList[1])
            CurrentImageIndex = 1
        end
    end
end

-- Copy an image and load it into the window
function OpenImageFile(path)
    CurrentFileName = GetFileName(path)
    CopyFile(path, love.filesystem.getSource() .. [[/cache/input.bin"]])
    LoadImage()
end

-- Get the name of the file without the folder structure or file extension
function GetFileName(path)
    local startpoint = 1
    for i = 1, #path do
        local ch = path:sub(i, i)
        if ch == '/' or ch == '\\' then
            startpoint = i + 1
        end
    end
    for i = #path, 1, -1 do
        if path:sub(i, i) == '.' then
            path = path:sub(startpoint, i-1)
            break
        end
    end
    return path
end

-- Resize the toolbars when the window is resized 
function ResizeWindows()
    ToolbarOptions = {X = love.graphics.getWidth() - (love.graphics.getWidth() / 4.0), Y = 0, W = love.graphics.getWidth() / 4.0, H = love.graphics.getHeight(), AutoSizeWindow = false, AllowResize = false, AllowFocus = false}
    ToolbarElementWidth = ToolbarOptions.W - 50

    local BackgroundColor = {0,0,0,0}
    if not PreviewImage then BackgroundColor = {0,0,0,1} end
    WindowOptions = {X = 0, Y = 0, W =  love.graphics.getWidth() - (love.graphics.getWidth() / 4.0), H = love.graphics.getHeight(), AutoSizeWindow = false, AllowResize = false, BgColor = BackgroundColor, AllowFocus = false}
end

-- Loads the image from input.bin to display on the screen
function LoadImage()
    Slab.ResetImageCache()
    local resetScaleAndPos = false
    if PreviewImage then
        PreviewImage = nil
    else
        resetScaleAndPos = true
    end
    if ImageData then
        ImageData:release()
        ImageData = nil
    end
    ImageData = love.image.newImageData('cache/input.bin')
    ImageDataSize.Width = ImageData:getWidth()
    ImageDataSize.Height = ImageData:getHeight()
    PreviewImage = love.graphics.newImage(ImageData)
    PreviewImage:setFilter('nearest', 'nearest')

    if resetScaleAndPos then
        ImageScale = 1
        ImagePos = {X = math.floor((WindowOptions.W / 2.0) - (PreviewImage:getWidth() / 2.0)), Y = math.floor((WindowOptions.H / 2.0) - (PreviewImage:getHeight() / 2.0))}
    end

    ResizeWindows()
    if SplitChannelEnabled then
        SplitChannel()
    else
        DitherImage()
    end
end

-- Iterate through all images in the list, dither each one, and save it to the output folder
function SaveAllImages()
    for i = 1, #ImageList do
        OpenImageFile(ImageList[i])
        SaveImage()
    end
    OpenImageFile(ImageList[CurrentImageIndex])
end

-- Copy the dithered image to the output folder, using the current file name for the png
function SaveImage()
    CopyFile(love.filesystem.getSource() .. [[/cache/temp.png]], love.filesystem.getSource() .. [[/output/]] .. CurrentFileName .. [[.png"]])
end

-- Reload the image when switching between dithered and original image
function ReloadImage()
    if ShowOriginal then
        Slab.ResetImageCache()
        ImageData:release()
        ImageData = nil
        ImageData = love.image.newImageData('cache/input.bin')
        PreviewImage = nil
        PreviewImage = love.graphics.newImage(ImageData)
        PreviewImage:setFilter('nearest', 'nearest')
        --PreviewImage:replacePixels(ImageData)
    else
        Slab.ResetImageCache()
        ImageData:release()
        ImageData = nil
        ImageData = love.image.newImageData('cache/temp.png')
        PreviewImage = nil
        PreviewImage = love.graphics.newImage(ImageData)
        PreviewImage:setFilter('nearest', 'nearest')
        --PreviewImage:replacePixels(ImageData)
    end
end

function SplitChannel()
    local channelString = [["]] .. ColorChannels.Red .. [[*r+]] .. ColorChannels.Green .. [[*g+]] .. ColorChannels.Blue .. [[*b"]]

    --magick convert input.png -fx "0.3*r+0.6*g+0.1*b" output.png
    local cmdString = [[""]] .. love.filesystem.getSource() ..
    [[/magick" "]] ..
    love.filesystem.getSource() .. [[/cache/input.bin" -channel rgb -fx ]] ..
    channelString .. [[ "]] ..
    love.filesystem.getSource() .. [[/cache/grayscale.png""]]
    
    cmdString = string.gsub(cmdString, [[/]], [[\]])

    print("\n" .. cmdString .. "\n")
    io.popen(cmdString):close()
    
    DitherImage()
end

-- Call the command line didder application with all of the parameters
function DitherImage()
    if not PreviewImage then return end
    
    local ditherString = ""

    if SelectedDitherType == 'Bayer Matrix' then
        if UseCustomBayerType then
            ditherString = [[ bayer ]] .. SelectedBayerType1 .. [[x]] .. SelectedBayerType2
         else
            ditherString = [[ bayer ]] .. SelectedBayerType
         end
    elseif SelectedDitherType == 'Ordered Dithering Matrix' then
        ditherString = [[ odm ]] .. SelectedOrderedType
    elseif SelectedDitherType == 'Error Diffusion Matrix' then
        if Serpentine then 
            ditherString = [[ edm --serpentine ]] .. SelectedErrorType
        else
            ditherString = [[ edm ]] .. SelectedErrorType
        end
    elseif SelectedDitherType == 'Random' then
        ditherString = [[ random ]] .. RandomMin .. [[ ]] .. RandomMax
    end

    local inputString = [["]] .. love.filesystem.getSource() .. [[/cache/input.bin"]]

    if SplitChannelEnabled then
        inputString = [["]] .. love.filesystem.getSource() .. [[/cache/grayscale.png"]]
    end

    local scaleString = ""
    if CurrentScale < 1.0 then
        scaleString = "-x " .. math.floor(ImageDataSize.Width * CurrentScale)
    end

    local paletteName = SelectedPalette or 'Game Boy Original'
    local currentPaletteString = PalettesMap[paletteName] or PalettesMap['Game Boy Original']
	
    local cmdString = [[""]] .. love.filesystem.getSource() ..
    [[/didder" ]] .. scaleString ..
    [[ --palette "]] .. currentPaletteString .. [[" -i ]] ..
    inputString .. [[ -o "]] ..
    love.filesystem.getSource() .. [[/cache/temp.png"]] ..
    [[ --strength ]] .. DitherParameters.Strength ..
    [[ --brightness ]] .. DitherParameters.Brightness ..
    [[ --contrast ]] .. DitherParameters.Contrast ..
    ditherString .. [[""]]
    
    cmdString = string.gsub(cmdString, [[/]], [[\]])

    print("\n" .. cmdString .. "\n")
    io.popen(cmdString):close()
    ImageData:release()
    ImageData = nil
    ImageData = love.image.newImageData('cache/temp.png')
    ReloadImage()
end	